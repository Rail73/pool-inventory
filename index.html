<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pool Parts Inventory - Online Mode</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .table-fixed-header thead th {
            position: sticky;
            top: 0;
            background-color: white; /* Ensure header background is white */
            z-index: 10;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="max-w-6xl mx-auto p-6">
        <div class="bg-white rounded-lg shadow-lg p-6">

            <div class="flex justify-between items-center mb-6">
                <h1 class="text-3xl font-bold text-gray-800">üèä‚Äç‚ôÇÔ∏è Pool Parts Inventory</h1>
                <div class="flex gap-2">
                    <button onclick="showSettings()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">
                        ‚öôÔ∏è Settings
                    </button>
                    <button onclick="loadParts()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                        üîÑ Refresh
                    </button>
                    <button onclick="showAddForm()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                        ‚ûï Add Part
                    </button>
                </div>
            </div>

            <div class="mb-4 flex items-center justify-between">
                <div>
                    <span id="status" class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">
                        <span class="h-2 w-2 rounded-full bg-green-500 mr-2"></span> Online (Google Sheets)
                    </span>
                    <p class="text-gray-500 text-sm mt-1">Make sure your Google Apps Script is deployed as a web app and the URL is set in settings.</p>
                </div>
                <div class="flex space-x-4 text-gray-700 text-sm">
                    <span>Total Items: <strong id="totalItems">0</strong></span>
                    <span>Critical Stock: <strong id="criticalStock" class="text-red-600">0</strong></span>
                    <span>Total Value: <strong id="totalValue">$0.00</strong></span>
                </div>
            </div>

            <div class="mb-6 flex space-x-4">
                <input type="text" id="searchInput" onkeyup="filterParts()" placeholder="Search by name or supplier..."
                       class="flex-1 p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                <select id="stockFilter" onchange="filterParts()"
                        class="p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    <option value="all">All Stock</option>
                    <option value="good">Good Stock</option>
                    <option value="low">Low Stock</option>
                    <option value="critical">Critical Stock</option>
                </select>
            </div>

            <div class="overflow-x-auto rounded-lg shadow border border-gray-200" style="max-height: 500px;">
                <table class="min-w-full divide-y divide-gray-200 table-fixed-header">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer" onclick="sortTable(0)">ID</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer" onclick="sortTable(1)">Name</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer" onclick="sortTable(2)">Stock</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer" onclick="sortTable(3)">Min Stock</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer" onclick="sortTable(4)">Price</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer" onclick="sortTable(5)">Supplier</th>
                            <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="partsTableBody" class="bg-white divide-y divide-gray-200">
                        </tbody>
                </table>
                <p id="noResultsMessage" class="text-center text-gray-500 p-4 hidden">No matching parts found.</p>
            </div>
        </div>
    </div>

    <div id="addForm" class="hidden fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl w-96">
            <h2 class="text-2xl font-bold mb-4">‚ûï Add New Part</h2>
            <div class="mb-4">
                <label for="partName" class="block text-sm font-medium text-gray-700">Part Name</label>
                <input type="text" id="partName" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
            </div>
            <div class="mb-4">
                <label for="partStock" class="block text-sm font-medium text-gray-700">Current Stock</label>
                <input type="number" id="partStock" value="0" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
            </div>
            <div class="mb-4">
                <label for="partMinStock" class="block text-sm font-medium text-gray-700">Minimum Stock</label>
                <input type="number" id="partMinStock" value="0" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
            </div>
            <div class="mb-4">
                <label for="partPrice" class="block text-sm font-medium text-gray-700">Price ($)</label>
                <input type="number" step="0.01" id="partPrice" value="0.00" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
            </div>
            <div class="mb-4">
                <label for="partSupplier" class="block text-sm font-medium text-gray-700">Supplier</label>
                <input type="text" id="partSupplier" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
            </div>
            <div class="flex justify-end space-x-2">
                <button onclick="hideAddForm()" class="bg-gray-400 text-white px-4 py-2 rounded-lg hover:bg-gray-500">Cancel</button>
                <button onclick="addPart()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Add Part</button>
            </div>
        </div>
    </div>

    <div id="editForm" class="hidden fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl w-96">
            <h2 class="text-2xl font-bold mb-4">‚úçÔ∏è Edit Part</h2>
            <input type="hidden" id="editPartId">
            <div class="mb-4">
                <label for="editPartName" class="block text-sm font-medium text-gray-700">Part Name</label>
                <input type="text" id="editPartName" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
            </div>
            <div class="mb-4">
                <label for="editPartStock" class="block text-sm font-medium text-gray-700">Current Stock</label>
                <input type="number" id="editPartStock" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
            </div>
            <div class="mb-4">
                <label for="editPartMinStock" class="block text-sm font-medium text-gray-700">Minimum Stock</label>
                <input type="number" id="editPartMinStock" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
            </div>
            <div class="mb-4">
                <label for="editPartPrice" class="block text-sm font-medium text-gray-700">Price ($)</label>
                <input type="number" step="0.01" id="editPartPrice" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
            </div>
            <div class="mb-4">
                <label for="editPartSupplier" class="block text-sm font-medium text-gray-700">Supplier</label>
                <input type="text" id="editPartSupplier" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
            </div>
            <div class="flex justify-end space-x-2">
                <button onclick="hideEditForm()" class="bg-gray-400 text-white px-4 py-2 rounded-lg hover:bg-gray-500">Cancel</button>
                <button onclick="updatePart()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Save Changes</button>
            </div>
        </div>
    </div>


    <div id="settingsPanel" class="hidden fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl w-96">
            <h2 class="text-2xl font-bold mb-4">‚öôÔ∏è Settings</h2>
            <div class="mb-4">
                <label for="apiUrl" class="block text-sm font-medium text-gray-700">Google Apps Script Web App URL</label>
                <input type="text" id="apiUrl" placeholder="Paste your deployed Apps Script URL here"
                       class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                <p class="text-xs text-gray-500 mt-1">Deploy your Apps Script as a web app and paste the URL here. Ensure 'Who has access' is set to 'Anyone'.</p>
            </div>
            <div class="flex justify-end space-x-2">
                <button onclick="hideSettings()" class="bg-gray-400 text-white px-4 py-2 rounded-lg hover:bg-gray-500">Cancel</button>
                <button onclick="saveApiUrl()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Save</button>
            </div>
        </div>
    </div>


    <script>
        let allParts = [];
        let sortedColumn = null;
        let sortDirection = 'asc';

        document.addEventListener('DOMContentLoaded', function() {
            const savedApiUrl = localStorage.getItem('googleApiUrl');
            if (savedApiUrl) {
                document.getElementById('apiUrl').value = savedApiUrl;
                loadParts();
            } else {
                updateStatus(false, 'API URL not set. Please go to Settings.');
                // Optionally show settings panel automatically if no URL
                // showSettings();
            }
        });

        function updateStatus(isOnline, message = '') {
            const statusSpan = document.getElementById('status');
            statusSpan.classList.remove('bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800');
            statusSpan.querySelector('span').classList.remove('bg-green-500', 'bg-red-500');

            if (isOnline) {
                statusSpan.classList.add('bg-green-100', 'text-green-800');
                statusSpan.querySelector('span').classList.add('bg-green-500');
                statusSpan.innerHTML = '<span class="h-2 w-2 rounded-full bg-green-500 mr-2"></span> Online (Google Sheets)';
            } else {
                statusSpan.classList.add('bg-red-100', 'text-red-800');
                statusSpan.querySelector('span').classList.add('bg-red-500');
                statusSpan.innerHTML = `<span class="h-2 w-2 rounded-full bg-red-500 mr-2"></span> Offline: ${message}`;
            }
        }

        async function loadParts() {
            const apiUrl = localStorage.getItem('googleApiUrl');
            if (!apiUrl) {
                updateStatus(false, 'API URL not set.');
                allParts = []; // Clear data if no API URL
                filterParts(); // Render empty table
                return;
            }

            updateStatus(true, 'Connecting...'); // Indicate trying to connect
            try {
                const response = await fetch(apiUrl + '?action=getParts');
                const data = await response.json();

                if (data.success) {
                    allParts = data.data;
                    updateStatus(true, 'Connected');
                } else {
                    updateStatus(false, 'API Error: ' + (data.error || 'Unknown error'));
                    allParts = []; // Clear data on API error
                }
            } catch (error) {
                updateStatus(false, 'Network Error: ' + error.message);
                allParts = []; // Clear data on network error
            }
            filterParts();
            updateStats();
        }

        function filterParts() {
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            const stockFilter = document.getElementById('stockFilter').value;

            let filtered = allParts.filter(part => {
                const matchesSearch = part.name.toLowerCase().includes(searchInput) ||
                                      part.supplier.toLowerCase().includes(searchInput) ||
                                      String(part.id).toLowerCase().includes(searchInput); // Allow searching by ID

                const status = getStockStatus(part.currentStock, part.minStock);
                const matchesFilter = stockFilter === 'all' || stockFilter === status;

                return matchesSearch && matchesFilter;
            });

            // Apply sorting
            if (sortedColumn !== null) {
                filtered.sort((a, b) => {
                    let valA, valB;
                    switch (sortedColumn) {
                        case 0: // ID
                            valA = a.id;
                            valB = b.id;
                            break;
                        case 1: // Name
                            valA = a.name.toLowerCase();
                            valB = b.name.toLowerCase();
                            break;
                        case 2: // Stock
                            valA = a.currentStock;
                            valB = b.currentStock;
                            break;
                        case 3: // Min Stock
                            valA = a.minStock;
                            valB = b.minStock;
                            break;
                        case 4: // Price
                            valA = a.price;
                            valB = b.price;
                            break;
                        case 5: // Supplier
                            valA = a.supplier.toLowerCase();
                            valB = b.supplier.toLowerCase();
                            break;
                        default:
                            return 0;
                    }

                    if (valA < valB) return sortDirection === 'asc' ? -1 : 1;
                    if (valA > valB) return sortDirection === 'asc' ? 1 : -1;
                    return 0;
                });
            }


            displayParts(filtered);
            updateStats();
        }

        function sortTable(columnIndex) {
            if (sortedColumn === columnIndex) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortedColumn = columnIndex;
                sortDirection = 'asc';
            }
            filterParts(); // Re-filter and re-display with new sort order
        }

        function displayParts(partsToDisplay) {
            const tableBody = document.getElementById('partsTableBody');
            tableBody.innerHTML = '';
            const noResultsMessage = document.getElementById('noResultsMessage');

            if (partsToDisplay.length === 0) {
                noResultsMessage.classList.remove('hidden');
                return;
            } else {
                noResultsMessage.classList.add('hidden');
            }

            partsToDisplay.forEach(part => {
                const row = tableBody.insertRow();
                const statusClass = getStatusClass(part.currentStock, part.minStock);
                const statusText = getStatusText(part.currentStock, part.minStock);

                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${part.id}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${part.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${statusClass} font-semibold">${part.currentStock} <span class="text-xs font-normal text-gray-500">(${statusText})</span></td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${part.minStock}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">$${part.price.toFixed(2)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${part.supplier}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium flex items-center justify-end space-x-2">
                        <button onclick="adjustStock(${part.id}, 1)" class="text-green-600 hover:text-green-900 px-2 py-1 rounded-md border border-green-600 hover:border-green-900 transition-colors duration-200">‚ûï</button>
                        <button onclick="adjustStock(${part.id}, -1)" class="text-red-600 hover:text-red-900 px-2 py-1 rounded-md border border-red-600 hover:border-red-900 transition-colors duration-200">‚ûñ</button>
                        <button onclick="showEditForm(${part.id})" class="text-yellow-600 hover:text-yellow-900 px-2 py-1 rounded-md border border-yellow-600 hover:border-yellow-900 transition-colors duration-200">‚úçÔ∏è</button>
                        <button onclick="deletePart(${part.id})" class="text-red-600 hover:text-red-900 px-2 py-1 rounded-md border border-red-600 hover:border-red-900 transition-colors duration-200">üóëÔ∏è</button>
                    </td>
                `;
            });
        }

        function getStockStatus(current, min) {
            if (current <= 0) return 'critical';
            if (current <= min) return 'low';
            return 'good';
        }

        function getStatusClass(current, min) {
            const status = getStockStatus(current, min);
            if (status === 'critical') return 'text-red-600';
            if (status === 'low') return 'text-orange-500';
            return 'text-green-600';
        }

        function getStatusText(current, min) {
            const status = getStockStatus(current, min);
            if (status === 'critical') return 'Critical';
            if (status === 'low') return 'Low';
            return 'Good';
        }

        function updateStats() {
            document.getElementById('totalItems').textContent = allParts.length;
            const criticalCount = allParts.filter(p => getStockStatus(p.currentStock, p.minStock) === 'critical').length;
            document.getElementById('criticalStock').textContent = criticalCount;
            const totalValue = allParts.reduce((sum, part) => sum + (part.currentStock * part.price), 0);
            document.getElementById('totalValue').textContent = `$${totalValue.toFixed(2)}`;
        }

        async function adjustStock(id, change) {
            const partIndex = allParts.findIndex(part => part.id === id);
            if (partIndex === -1) {
                alert('Part not found in local data. Please refresh.');
                return;
            }

            const apiUrl = localStorage.getItem('googleApiUrl');
            if (!apiUrl) {
                alert('API URL is not set. Cannot update stock online.');
                return;
            }

            // Optimistic UI update
            const originalStock = allParts[partIndex].currentStock;
            allParts[partIndex].currentStock = Math.max(0, originalStock + change);
            filterParts(); // Re-render table with optimistic update
            updateStats();

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'updateStock', id: id, change: change })
                });
                const data = await response.json();

                if (data.success) {
                    console.log('Stock updated online:', data.message);
                    // No need to loadParts() if we trust the optimistic update and API just confirmed it
                    // But for robustness, we can refresh:
                    loadParts();
                } else {
                    alert('Failed to update stock online: ' + (data.error || 'Unknown API error'));
                    console.error('API Error:', data.error);
                    // Revert optimistic update on failure
                    allParts[partIndex].currentStock = originalStock;
                    filterParts();
                    updateStats();
                }
            } catch (error) {
                alert('Network error while updating stock: ' + error.message);
                console.error('Network error:', error);
                // Revert optimistic update on failure
                allParts[partIndex].currentStock = originalStock;
                filterParts();
                updateStats();
            }
        }

        async function addPart() {
            const name = document.getElementById('partName').value.trim();
            if (!name) {
                alert('Please enter a part name');
                return;
            }

            const apiUrl = localStorage.getItem('googleApiUrl');
            if (!apiUrl) {
                alert('API URL is not set. Cannot add part online.');
                return;
            }

            const newPartData = {
                action: 'addPart',
                name: name,
                currentStock: parseInt(document.getElementById('partStock').value) || 0,
                minStock: parseInt(document.getElementById('partMinStock').value) || 0,
                price: parseFloat(document.getElementById('partPrice').value) || 0,
                supplier: document.getElementById('partSupplier').value.trim() || 'Unknown'
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newPartData)
                });
                const data = await response.json();

                if (data.success) {
                    alert('Part added successfully!');
                    console.log('Part added online:', data.message, 'ID:', data.id);
                    // Clear form
                    document.getElementById('partName').value = '';
                    document.getElementById('partStock').value = '0';
                    document.getElementById('partMinStock').value = '0';
                    document.getElementById('partPrice').value = '0.00';
                    document.getElementById('partSupplier').value = '';

                    hideAddForm();
                    loadParts(); // Reload data to get the new part with its actual ID
                } else {
                    alert('Failed to add part online: ' + (data.error || 'Unknown API error'));
                    console.error('API Error:', data.error);
                }
            } catch (error) {
                alert('Network error while adding part: ' + error.message);
                console.error('Network error:', error);
            }
        }

        async function deletePart(id) {
            if (!confirm('Are you sure you want to delete this part?')) {
                return;
            }

            const apiUrl = localStorage.getItem('googleApiUrl');
            if (!apiUrl) {
                alert('API URL is not set. Cannot delete part online.');
                return;
            }

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'deletePart', id: id })
                });
                const data = await response.json();

                if (data.success) {
                    alert('Part deleted successfully!');
                    console.log('Part deleted online:', data.message);
                    loadParts(); // Reload data after deletion
                } else {
                    alert('Failed to delete part online: ' + (data.error || 'Unknown API error'));
                    console.error('API Error:', data.error);
                }
            } catch (error) {
                alert('Network error while deleting part: ' + error.message);
                console.error('Network error:', error);
            }
        }

        function showEditForm(id) {
            const part = allParts.find(p => p.id === id);
            if (!part) {
                alert('Part not found for editing.');
                return;
            }

            document.getElementById('editPartId').value = part.id;
            document.getElementById('editPartName').value = part.name;
            document.getElementById('editPartStock').value = part.currentStock;
            document.getElementById('editPartMinStock').value = part.minStock;
            document.getElementById('editPartPrice').value = part.price.toFixed(2);
            document.getElementById('editPartSupplier').value = part.supplier;

            document.getElementById('editForm').classList.remove('hidden');
        }

        function hideEditForm() {
            document.getElementById('editForm').classList.add('hidden');
        }

        async function updatePart() {
            const id = parseInt(document.getElementById('editPartId').value);
            const name = document.getElementById('editPartName').value.trim();
            const currentStock = parseInt(document.getElementById('editPartStock').value);
            const minStock = parseInt(document.getElementById('editPartMinStock').value);
            const price = parseFloat(document.getElementById('editPartPrice').value);
            const supplier = document.getElementById('editPartSupplier').value.trim();

            if (!name || isNaN(currentStock) || isNaN(minStock) || isNaN(price)) {
                alert('Please fill all required fields with valid data.');
                return;
            }

            const apiUrl = localStorage.getItem('googleApiUrl');
            if (!apiUrl) {
                alert('API URL is not set. Cannot update part online.');
                return;
            }

            const updatedPartData = {
                action: 'updatePart',
                id: id,
                name: name,
                currentStock: currentStock,
                minStock: minStock,
                price: price,
                supplier: supplier
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updatedPartData)
                });
                const data = await response.json();

                if (data.success) {
                    alert('Part updated successfully!');
                    console.log('Part updated online:', data.message);
                    hideEditForm();
                    loadParts(); // Reload data after update
                } else {
                    alert('Failed to update part online: ' + (data.error || 'Unknown API error'));
                    console.error('API Error:', data.error);
                }
            } catch (error) {
                alert('Network error while updating part: ' + error.message);
                console.error('Network error:', error);
            }
        }


        function showSettings() {
            document.getElementById('settingsPanel').classList.remove('hidden');
        }

        function hideSettings() {
            document.getElementById('settingsPanel').classList.add('hidden');
        }

        function saveApiUrl() {
            const url = document.getElementById('apiUrl').value.trim();
            localStorage.setItem('googleApiUrl', url);
            hideSettings();
            if (url) {
                loadParts();
            }
            alert('Settings saved!');
        }

        function showAddForm() {
            // Clear any previous values in the add form
            document.getElementById('partName').value = '';
            document.getElementById('partStock').value = '0';
            document.getElementById('partMinStock').value = '0';
            document.getElementById('partPrice').value = '0.00';
            document.getElementById('partSupplier').value = '';
            document.getElementById('addForm').classList.remove('hidden');
        }

        function hideAddForm() {
            document.getElementById('addForm').classList.add('hidden');
        }

        // Add keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'n') {
                e.preventDefault();
                showAddForm();
            }
            if (e.key === 'Escape') {
                hideAddForm();
                hideSettings();
                hideEditForm(); // Hide edit form on escape
            }
        });
    </script>
</body>
</html>
