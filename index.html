<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–£—á—ë—Ç –ó–∞–ø—á–∞—Å—Ç–µ–π</title>
  <script>
    const SHEET_URL = 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec'; // –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Å–≤–æ–π ID
    async function fetchParts() {
      try {
        const res = await fetch(`${SHEET_URL}?action=getParts`);
        const json = await res.json();
        renderTable(json);
        document.getElementById("status").textContent = "Connected";
      } catch (e) {
        console.error(e);
        document.getElementById("status").textContent = "Disconnected";
      }
    }
    async function addPart() {
      const name = document.getElementById("add-name").value;
      const stock = +document.getElementById("add-stock").value;
      const minStock = +document.getElementById("add-min").value;
      const price = +document.getElementById("add-price").value;
      const supplier = document.getElementById("add-supplier").value;
      const category = document.getElementById("add-category").value;
      const params = new URLSearchParams({
        action: 'addPart', name, currentStock: stock, minStock, price, supplier, category
      });
      await fetch(`${SHEET_URL}?${params.toString()}`);
      fetchParts();
    }
    async function deletePart(id) {
      await fetch(`${SHEET_URL}?action=deletePart&id=${id}`);
      fetchParts();
    }
    async function updateStock(id, delta) {
      await fetch(`${SHEET_URL}?action=updateStock&id=${id}&delta=${delta}`);
      fetchParts();
    }
    function renderTable(data) {
      const tbody = document.getElementById("table-body");
      tbody.innerHTML = '';
      data.forEach(row => {
        const tr = document.createElement("tr");
        const stockClass = row.currentStock <= row.minStock ?
          'bg-red-100' : row.currentStock <= row.minStock * 1.5 ? 'bg-yellow-100' : 'bg-green-100';
        tr.innerHTML = `
          <td>${row.id}</td>
          <td>${row.name}</td>
          <td class="${stockClass}">${row.currentStock}</td>
          <td>${row.minStock}</td>
          <td>${row.price}</td>
          <td>${row.supplier}</td>
          <td>${row.category}</td>
          <td>
            <button onclick="updateStock(${row.id},1)" class="px-2">+1</button>
            <button onclick="updateStock(${row.id},-1)" class="px-2">-1</button>
          </td>
          <td><button onclick="deletePart(${row.id})">‚ùå</button></td>
        `;
        tbody.appendChild(tr);
      });
    }
    function exportJSON() {
      const rows = [...document.querySelectorAll("#table-body tr")].map(tr => {
        const cells = tr.querySelectorAll("td");
        return {
          id: cells[0].textContent,
          name: cells[1].textContent,
          currentStock: cells[2].textContent,
          minStock: cells[3].textContent,
          price: cells[4].textContent,
          supplier: cells[5].textContent,
          category: cells[6].textContent
        };
      });
      const blob = new Blob([JSON.stringify(rows, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "inventory.json";
      a.click();
    }
    window.onload = fetchParts;
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-4">
  <h1 class="text-2xl font-bold mb-4">üì¶ –£—á—ë—Ç –ó–∞–ø—á–∞—Å—Ç–µ–π</h1>
  <div class="mb-2">–°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: <span id="status" class="font-semibold">...</span></div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div>
      <h2 class="font-semibold mb-2">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h2>
      <input id="add-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" class="border p-1 w-full mb-1">
      <input id="add-stock" type="number" placeholder="–û—Å—Ç–∞—Ç–æ–∫" class="border p-1 w-full mb-1">
      <input id="add-min" type="number" placeholder="–ú–∏–Ω. –æ—Å—Ç–∞—Ç–æ–∫" class="border p-1 w-full mb-1">
      <input id="add-price" type="number" placeholder="–¶–µ–Ω–∞" class="border p-1 w-full mb-1">
      <input id="add-supplier" placeholder="–ü–æ—Å—Ç–∞–≤—â–∏–∫" class="border p-1 w-full mb-1">
      <input id="add-category" placeholder="–ö–∞—Ç–µ–≥–æ—Ä–∏—è" class="border p-1 w-full mb-1">
      <button onclick="addPart()" class="bg-blue-500 text-white px-4 py-2 rounded">–î–æ–±–∞–≤–∏—Ç—å</button>
    </div>
    <div>
      <h2 class="font-semibold mb-2">üì§ –≠–∫—Å–ø–æ—Ä—Ç</h2>
      <button onclick="exportJSON()" class="bg-green-500 text-white px-4 py-2 rounded">–í JSON</button>
    </div>
  </div>

  <h2 class="text-xl font-bold mt-6 mb-2">üìã –¢–∞–±–ª–∏—Ü–∞</h2>
  <table class="min-w-full bg-white shadow-md">
    <thead class="bg-gray-200">
      <tr><th>ID</th><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>–û—Å—Ç.</th><th>–ú–∏–Ω.</th><th>–¶–µ–Ω–∞</th><th>–ü–æ—Å—Ç–∞–≤—â–∏–∫</th><th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th><th>+/-</th><th>–£–¥–∞–ª–∏—Ç—å</th></tr>
    </thead>
    <tbody id="table-body"></tbody>
  </table>

  <details class="mt-6">
    <summary class="font-semibold">üìò –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ Google Sheets</summary>
    <ol class="list-decimal pl-5">
      <li>–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é Google –¢–∞–±–ª–∏—Ü—É.</li>
      <li>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –º–µ–Ω—é –†–∞—Å—à–∏—Ä–µ–Ω–∏—è ‚Üí Apps Script.</li>
      <li>–í—Å—Ç–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–¥ (–Ω–∏–∂–µ).</li>
      <li>–û–ø—É–±–ª–∏–∫—É–π—Ç–µ ‚Üí –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∫–∞–∫ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Üí –£–∫–∞–∂–∏—Ç–µ –¥–æ—Å—Ç—É–ø: –¥–ª—è –≤—Å–µ—Ö, –∏ –ø–æ–ª—É—á–∏—Ç–µ URL.</li>
      <li>–ó–∞–º–µ–Ω–∏—Ç–µ YOUR_SCRIPT_ID –≤ –∫–æ–¥–µ –Ω–∞ –≤–∞—à ID –∏–∑ URL.</li>
    </ol>
    <pre class="bg-gray-100 p-2 mt-2 text-sm overflow-auto" id="script-code">
function doGet(e) {
  const ss = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('Parts');
  const action = e.parameter.action;
  const id = e.parameter.id;
  if (action == 'getParts') {
    const data = ss.getDataRange().getValues().slice(1);
    return ContentService.createTextOutput(JSON.stringify(data.map(r => ({
      id: r[0], name: r[1], currentStock: r[2], minStock: r[3], price: r[4], supplier: r[5], category: r[6]
    })))).setMimeType(ContentService.MimeType.JSON);
  }
  if (action == 'addPart') {
    const nextId = ss.getLastRow();
    ss.appendRow([nextId, e.parameter.name, +e.parameter.currentStock, +e.parameter.minStock, +e.parameter.price, e.parameter.supplier, e.parameter.category]);
    return ContentService.createTextOutput('OK');
  }
  if (action == 'deletePart') {
    const data = ss.getDataRange().getValues();
    for (let i = 1; i < data.length; i++) if (data[i][0] == id) ss.deleteRow(i + 1);
    return ContentService.createTextOutput('OK');
  }
  if (action == 'updateStock') {
    const data = ss.getDataRange().getValues();
    for (let i = 1; i < data.length; i++) {
      if (data[i][0] == id) {
        ss.getRange(i + 1, 3).setValue(+data[i][2] + +e.parameter.delta);
        break;
      }
    }
    return ContentService.createTextOutput('OK');
  }
  return ContentService.createTextOutput('Unknown action');
}
    </pre>
  </details>
</body>
</html>
